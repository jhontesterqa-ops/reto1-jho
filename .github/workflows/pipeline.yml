name: Ejecuci칩n Autom치tica de Pruebas 游

# Esto dice: "Ejec칰tame cada vez que haga un push a la rama main"
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test-execution:
    runs-on: ubuntu-latest # Usamos una m치quina virtual Linux

    steps:
    # 1. Descargamos tu c칩digo en la m치quina virtual
    - name: 游닌 Checkout del repositorio
      uses: actions/checkout@v4

    # 2. Preparamos el entorno de Node.js
    - name: 游릭 Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'

    # 3. Instalamos las dependencias (npm install)
    - name: 游닍 Instalar dependencias
      run: npm ci

    # 4. Instalamos los navegadores necesarios para Playwright
    - name: 游꿠 Instalar navegadores Playwright
      run: npx playwright install --with-deps

    # 5. EJECUCI칍N CLAVE: Esto levanta el json-server y corre los tests
    # Usamos el mismo comando 'npm test' que arreglamos en tu PC
    - name: 游댠 Ejecutar Pruebas (Mock Server + Cucumber)
      run: npm test

    # 6. Guardamos los reportes para que puedas descargarlos
    # 'if: always()' asegura que se guarde el reporte aunque fallen las pruebas
    - name: 游늵 Subir Reporte HTML
      if: always() 
      uses: actions/upload-artifact@v4
      with:
        name: reporte-cucumber
        path: reports/
        retention-days: 30
